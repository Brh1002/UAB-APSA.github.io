function prepareUpload(e){files=e.target.files}var main,form,warnTitle,list,ilist,listArr,oldEditKey,main=$("#main"),files={},submitFunc=function(e){e.preventDefault(),$("#submitText").text("Loading, please wait - this may take a while especially if you are submitting a file.").attr("style","color:black;font-weight:normal;"),google.script.run("processForm",this.parentNode,"formResp")},resubmitFunc="$('#submitText').text('Loading, please wait - this may take a while especially if you are submitting a file.').attr('style','color:black;font-weight:normal;');google.script.run('reprocessForm', this.parentNode, 'formResp')",google={script:{}};google.script.run=function(e,t,i){console.log(t,$(t)),t=$(t).serializeArray(),t.push({name:"funcToCall",value:e}),console.log(t),$.post("https://script.google.com/macros/s/AKfycbwaaNIG1tZXJz26-7FWZIQG1HeMnyPPlRs4D0S6hx-JXoN9bVo/exec?callback="+i,t)},$("<h1>",{text:"Submit Research Project"}).appendTo(main);var form=$("<form>",{id:"lookUpOld"}).appendTo(main);$('<div class="emp">',{text:"* - indicates required field"}).appendTo(form),$("<h2>",{text:"Please indicate if this is a first submission of a new project or an update to a previously submitted project."}).appendTo(form),$('<div style="font-weight: bold;">',{text:"Disabled for Demo."}).appendTo(form),list=$("<select>",{name:"formtype",id:"formtype"}).appendTo(form).change(function(){"Previous"===$("#formtype option:selected").val()?($("<div>",{text:"Enter your editing key:"}).appendTo(forID),$("<input>",{type:"text",id:"keyForEdit"}).appendTo(forID),$("<input>",{value:"submit","class":"login login-submit",id:"secondSub",style:"width:100%",onclick:"$('#findText').text('Looking up your project, give this a minute.');google.script.run.withSuccessHandler(oldResp).findOld($('#keyForEdit').val())"}).appendTo(forID),$("<span>",{id:"findText"}).appendTo(forID),$("#rest").hide()):(forID.empty(),$("#rest").show())}),$("<option>",{value:"NewForm",text:"New project"}).appendTo(list);var oldResp=function(e){if(e){$("#mainSub").attr("onclick",resubmitFunc),$("<input>",{type:"text",name:"id",val:$("#keyForEdit").val()}).appendTo(form).hide();for(var t in e)if("file"===t)$("#additionalInfoForFile").html('Already have <a target="_blank" href="'+e[t][1]+'">'+e[t][0]+"</a>. If you would like to replace this file then feel free to upload a new one."),$("<input>",{type:"text",name:"oldFile",val:JSON.stringify(e[t])}).appendTo(form).hide();else if("Division"===t)for(var i=0;i<e[t].length;i+=1){var a=e[t][i],o=a.split("-")[0];$("#dep"+o).prop("checked",!0).click(),$("[name="+t+"]").val(e[t])}else"understand"===t||(t.match(/Other\-/)?($("#"+t).prop("checked",!0).click(),$("[name="+t+"]").val(e[t])):$("[name="+t+"]").val(e[t]));$("#secondSub").remove(),oldEditKey=$("#keyForEdit").val(),$("#lookUpOld").html("<h2><b>"+$("#keyForEdit").val()+" was found, please make any edits below, submission date will be updated to today's date</b></h2>"),$("#rest").append($("<input>",{name:"ftID",type:"hidden",val:e.ftID})),$("#rest").show();var n=$("<button>",{"class":"login login-submit",style:"width:100%;background-color:red;",text:"Delete this entry."}).click(function(t){t.preventDefault(),window.confirm("Are you sure you would like to delete this entry?")&&google.script.run.withSuccessHandler(deleteResp).deleteEntry(e.ftID)});$("#lookUpOld").append(n),$("#lookUpOld").append($("<div>",{id:"dwarn"}))}else $("#findText").text("Sorry, could not find your project, make sure you did not make a typo.");console.log(e)},deleteResp=function(e){e?main.text("Successfully Deleted File: "+oldEditKey+". Thank you. To complete another submission, please refresh the page."):$("#dwarn").text("Delete failed due to a database error, if this problem occurs again please email us at <a href='mailto:UAB.APSA@gmail.com'>UAB.APSA@gmail.com</a>.").attr("style","color:red;font-weight:bold;")},forID=$("<span>").appendTo(form),form=$("<form>",{id:"rest"}).appendTo(main),longTermChecks=[],interTermChecks=[],shortTermChecks=[];$("<h2>",{id:"Audience",text:"Audience*"}).appendTo(form),$("<div>",{text:"TESTING: Select any check box below and a secondary dialog box will appear."}).appendTo(form),$("<h3>",{id:"ShortTerm",text:"Long Term Project(s) (> 1 year)"}).appendTo(form),$("<span>",{text:"Select All That Apply"}).appendTo(form),list=$("<ul>").appendTo(form),ilist=$("<li>").appendTo(list),longTermChecks.push($("<input>",{name:"Audience",type:"checkbox",value:"Undergraduate Student - Long Term"}).appendTo(ilist)),$("<span>",{text:"Undergraduate Student - Multi-Year"}).appendTo(ilist),ilist=$("<li>").appendTo(list),longTermChecks.push($("<input>",{name:"Audience",type:"checkbox",value:"Graduate or MD/PhD Student"}).appendTo(ilist)),$("<span>",{text:"Graduate or MD/PhD Student"}).appendTo(ilist),listLongTerm=$("<ul>").appendTo(form),$("<h3>",{id:"Intermediate",text:"Intermediate Term Project(s) (~ 1 year)"}).appendTo(form),$("<span>",{text:"Select All That Apply"}).appendTo(form),list=$("<ul>").appendTo(form),ilist=$("<li>").appendTo(list),interTermChecks.push($("<input>",{name:"Audience",type:"checkbox",value:"Undergraduate Student - Academic Year"}).appendTo(ilist)),$("<span>",{text:"Undergraduate Student - Summer"}).appendTo(ilist),ilist=$("<li>").appendTo(list),interTermChecks.push($("<input>",{name:"Audience",type:"checkbox",value:"Medical Student - Year Out"}).appendTo(ilist)),$("<span>",{text:"Medical Student - Year Out"}).appendTo(ilist),ilist=$("<li>").appendTo(list),interTermChecks.push($("<input>",{name:"Audience",type:"checkbox",value:"Masters Student"}).appendTo(ilist)),$("<span>",{text:"Masters Student - Rotation (~8 weeks)"}).appendTo(ilist),ilist=$("<li>").appendTo(list),interTermChecks.push($("<input>",{name:"Audience",type:"checkbox",value:"Resident - Year-Long"}).appendTo(ilist)),$("<span>",{text:"Medical Resident/Fellow"}).appendTo(ilist),listInterTerm=$("<ul>").appendTo(form),$("<h3>",{id:"ShortTerm",text:"Short Term Project(s) (~ 8 weeks)"}).appendTo(form),$("<span>",{text:"Select All That Apply"}).appendTo(form),list=$("<ul>").appendTo(form),ilist=$("<li>").appendTo(list),shortTermChecks.push($("<input>",{name:"Audience",type:"checkbox",value:"Undergraduate Student - Short Term"}).appendTo(ilist)),$("<span>",{text:"Undergraduate Student - Summer"}).appendTo(ilist),ilist=$("<li>").appendTo(list),shortTermChecks.push($("<input>",{name:"Audience",type:"checkbox",value:"Medical Student - Summer"}).appendTo(ilist)),$("<span>",{text:"Medical Student - Summer Research (~6-8 weeks)"}).appendTo(ilist),ilist=$("<li>").appendTo(list),shortTermChecks.push($("<input>",{name:"Audience",type:"checkbox",value:"Medical Student - Scholarly"}).appendTo(ilist)),$("<span>",{text:"Medical Student - Scholarly Activity (~8 weeks)"}).appendTo(ilist),ilist=$("<li>").appendTo(list),shortTermChecks.push($("<input>",{name:"Audience",type:"checkbox",value:"Graduate Student - Short Term"}).appendTo(ilist)),$("<span>",{text:"Graduate Student - Rotation (~8 weeks)"}).appendTo(ilist),ilist=$("<li>").appendTo(list),shortTermChecks.push($("<input>",{name:"Audience",type:"checkbox",value:"Resident - Short Term"}).appendTo(ilist)),$("<span>",{text:"Medical Resident/Fellow"}).appendTo(ilist),listShortTerm=$("<ul>").appendTo(form);var longTermOpen=!1;longTermChecks.map(function(e){e.click(function(){console.log("clicked!!",this.checked),longTermOpen=this.checked?populateTermForm(longTermOpen,listLongTerm):removeTermForm(longTermOpen,longTermChecks,listLongTerm)})});var interTermOpen=!1;interTermChecks.map(function(e){e.click(function(){console.log("clicked!!",this.checked),interTermOpen=this.checked?populateTermForm(interTermOpen,listInterTerm):removeTermForm(interTermOpen,interTermChecks,listInterTerm)})});var shortTermOpen=!1;shortTermChecks.map(function(e){e.click(function(){console.log("clicked!!",this.checked),shortTermOpen=this.checked?populateTermForm(shortTermOpen,listShortTerm):removeTermForm(shortTermOpen,shortTermChecks,listShortTerm)})});var shortTermOpen=!1;populateTermForm=function(e,t){return e||(t.show(),e=!0,addProject(t)),e},removeTermForm=function(e,t,i){e=!1;for(var a=0;a<t.length;a+=1)t[a][0].checked&&(e=!0);return e||i.children().remove(),e},addProject=function(e){var t=$("<li>").appendTo(e);$('<div style="">',{text:"Please note that this is supposed to describe a project for which you are currently seeking students. You may add as many projects as you would like."}).appendTo(t),$("<h2>",{id:"Summary",text:"Project Name/Summary*"}).appendTo(t),$("<div>",{text:"150 character maximum"}).appendTo(t),$("<input>",{name:"Summary",type:"text"}).appendTo(t).keyup(function(e){warnTitle.text($(e.target).val().length>75?"Currently you have "+$(e.target).val().length+" characters, please limit this to 75":"")}),warnTitle=$("<div>",{id:"warnTitle","class":"warn"}).appendTo(t);var i;$("<h2>",{id:"description",text:"Full Opportunity Description*"}).appendTo(t),$("<div>",{text:"5,000 character maximum. Please describe the goal of the project, the role of the student in the project, and the types of experiments that will be done. Description should be specific to the time frame indicated."}).appendTo(t),$("<textarea>",{name:"description",rows:20,cols:82}).appendTo(t).keyup(function(e){i.text($(e.target).val().length>5e3?"Currently you have "+$(e.target).val().length+" characters, please limit this to 5,000":"")}),i=$("<div>",{id:"warnTitle","class":"warn"}).appendTo(t),$("<h2>",{text:"URL to additional information or online application"}).appendTo(t),$("<input>",{name:"urlToAddRes",type:"text"}).appendTo(t),$("<h2>",{text:"Add or Remove Project?"}).appendTo(t),$("<button>",{text:"Remove Project (Not Functional)"}).click(function(e){e.preventDefault()}).appendTo(t),function(e){$("<button>",{text:"Add Additional Project"}).click(function(t){t.preventDefault(),addProject(e)}).appendTo(t)}(e)},$("<h2>",{id:"Site",text:"Research Site*"}).appendTo(form),list=$("<ul>").appendTo(form),ilist=$("<li>").appendTo(list),$("<input>",{name:"Site",type:"radio",value:"Birmingham Campus"}).appendTo(ilist),$("<span>",{text:"Birmingham Campus"}).appendTo(ilist),ilist=$("<li>").appendTo(list),$("<input>",{name:"Site",type:"radio",value:"Huntsville Campus"}).appendTo(ilist),$("<span>",{text:"Huntsville Campus"}).appendTo(ilist),ilist=$("<li>").appendTo(list),$("<input>",{name:"Site",type:"radio",value:"Tuscaloosa Campus"}).appendTo(ilist),$("<span>",{text:"Tuscaloosa Campus"}).appendTo(ilist),ilist=$("<li>").appendTo(list),$("<input>",{name:"Site",type:"radio",value:"Montgomery Campus"}).appendTo(ilist),$("<span>",{text:"Montgomery Campus"}).appendTo(ilist),ilist=$("<li>").appendTo(list),$("<input>",{name:"Site",type:"radio",value:"Children’s of Alabama"}).appendTo(ilist),$("<span>",{text:"Children’s of Alabama"}).appendTo(ilist),ilist=$("<li>").appendTo(list),$("<input>",{name:"Site",type:"radio",value:"Birmingham VA Medical Center"}).appendTo(ilist),$("<span>",{text:"Birmingham VA Medical Center"}).appendTo(ilist),ilist=$("<li>").appendTo(list),$("<input>",{name:"Site",type:"radio",value:"Southern Research Institute"}).appendTo(ilist),$("<span>",{text:"Southern Research Institute"}).appendTo(ilist),ilist=$("<li>").appendTo(list),$("<input>",{name:"Site",type:"radio",value:"Hudson Alpha"}).appendTo(ilist),$("<span>",{text:"Hudson Alpha"}).appendTo(ilist),ilist=$("<li>").appendTo(list),$("<input>",{id:"Other-Site",name:"Site",type:"radio",value:"Other"}).appendTo(ilist),$("[name=Site]").click(function(){tempSite.find("input").remove(),"Other"===$(this).val()&&tempSite.append($("<input>",{style:"width:400px;",name:"Other-Site",type:"text"}))});var tempSite=$("<span>",{html:'<span style="display: inline-block;width:60px;">Other</span>'}).appendTo(ilist);listArr={Anesthesiology:[],"Biochemistry & Molecular Genetics":[],"Cell, Developmental, & Integrative Biology":[],Dermatology:[],"Emergency Medicine":[],"Family & Community Medicine":[],Genetics:[],"Medical Education":[],Medicine:["Cardiology","Immunology & Rheumatology","Endocrinology, Diabetes, & Metabolism","Gastroenterology & Hepatology","General Internal Medicine","Gerontology, Geriatrics, & Palliative Care","Hematology/Oncology","Infectious Diseases","Nephrology","Preventative Medicine","Pulmonary, Allergy, & Critical Care"],Microbiology:[],Neurobiology:[],Neurology:[],Neurosurgery:[],"Obstetrics & Gynecology":[],Ophthalmology:[],Pathology:[],Pediatrics:["Allergy & Immunology","Cardiology","Critical Care","Emergency Medicine","Endocrinology","Gastroenterology","General Pediatrics & Adolescent Medicine","Hospital Medicine","Hematology/Oncology","Infectious Diseases","Neonatology","Nephrology","Child Neurology","Pulmonary & Sleep Medicine","Rehabilitation Medicine","Rheumatology"],"Pharmacology & Toxicology":[],"Physical Medicine & Rehabilitation":[],"Psychiatric & Behavioral Neurobiology":[],"Radiation Oncology":[],Radiology:[],Surgery:["Cardiothoracic Surgery","General Surgery","Oral & Maxillofacial Surgery","Orthopedic Surgery","Otolaryngology, Head, & Neck Surgery","Pediatric Surgery","Plastic Surgery","Transplantation Surgery"],Urology:[]},$("<h2>").append($("<span>",{id:"Department",text:"Department*/"})).append($("<span>",{id:"Division",text:"Division*"})).appendTo(form),$("<span>",{text:"Select All That Apply"}).appendTo(form),list=$("<ul>").appendTo(form);for(var depart in listArr)ilist=$("<li>").appendTo(list),listArr[depart].length>0?($("<input>",{id:"dep"+depart,name:"Department",type:"checkbox",value:depart}).appendTo(ilist),$("<span>",{text:depart}).appendTo(ilist),function(e,t,i){t.find("input").click(function(){if(this.checked){var a=$("<select>",{name:"Division"}).appendTo(t);$("<option>",{value:!1,text:"Select a Division*"}).appendTo(a);for(var o=0;o<e.length;o+=1)$("<option>",{value:i+"-"+e[o],text:e[o]}).appendTo(a)}else t.find("select").remove()})}(listArr[depart],ilist,depart)):($("<input>",{name:"Department",type:"checkbox",value:depart}).appendTo(ilist),$("<span>",{text:depart}).appendTo(ilist));ilist=$("<li>").appendTo(list),$("<input>",{id:"Other-Department",name:"Department",type:"checkbox",value:"Other"}).appendTo(ilist).click(function(){this.checked?tempDep.append($("<input>",{style:"width:400px;",name:"Other-Department",type:"text"})):tempDep.find("input").remove()});var tempDep=$("<span>",{html:'<span style="display: inline-block;width:60px;">Other</span>'}).appendTo(ilist);listArr=["Basic science","Translational science","Clinical Research","Behavioral Research","Chart Review","Community-based","Education","Public Health/Epidemiology","Health Outcomes"],$("<h2>",{id:"RType",text:"Research Type*"}).appendTo(form),$("<span>",{text:"Select All That Apply"}).appendTo(form),list=$("<ul>").appendTo(form);for(var i=0;i<listArr.length;i+=1)ilist=$("<li>").appendTo(list),$("<input>",{name:"RType",type:"checkbox",value:listArr[i]}).appendTo(ilist),$("<span>",{text:listArr[i]}).appendTo(ilist);ilist=$("<li>").appendTo(list),$("<input>",{id:"Other-RType",name:"RType",type:"checkbox",value:"Other"}).appendTo(ilist).click(function(){this.checked?tempRType.append($("<input>",{style:"width:400px;",name:"Other-RType",type:"text"})):tempRType.find("input").remove()});var tempRType=$("<span>",{html:'<span style="display: inline-block;width:60px;">Other</span>'}).appendTo(ilist);$("<h2>",{id:"PI",text:"Primary Investigator*"}).appendTo(form),$("<input>",{name:"PI",type:"text"}).appendTo(form),$("<h2>",{text:"Project Contact Information*"}).appendTo(form),$("<span>",{id:"cName",text:"Contact Name*"}).appendTo(form),$("<input>",{name:"cName",type:"text"}).appendTo(form);var warnEmail;$("<span>",{id:"cEmail",text:"Contact E-mail*"}).appendTo(form),$("<input>",{name:"cEmail",type:"text"}).appendTo(form).keyup(function(e){warnEmail.text($(e.target).val().match(/[\s\S]+@[\s\S]+\.[\s\S]+/)?"":"Must be a valid email address.")}),warnEmail=$("<div>",{id:"warnTitle","class":"warn"}).appendTo(form);var warnPhone;$("<span>",{id:"cPN",text:"Contact Phone Number* [123-123-1234]"}).appendTo(form),$("<input>",{name:"cPN",type:"text"}).appendTo(form).keyup(function(e){warnPhone.text($(e.target).val().match(/^\d{3}\-\d{3}\-\d{4}$/)?"":"Must be a 10 digit phone number in this form: 123-123-1234.")}),warnPhone=$("<div>",{id:"warnTitle","class":"warn"}).appendTo(form),$("<br>").appendTo(form),$("<br>").appendTo(form),$("<span>",{id:"understand",text:"*This database is intended solely as a resource to advertise available research opportunities at UAB.  Checking the box below indicates you understand that posting a research opportunity does not guarantee you will be contacted by a student."}).appendTo(form),$("<br>").appendTo(form),$("<input>",{name:"understand",type:"checkbox",value:!0}).appendTo(form),$("<span>",{text:"I understand the above statement"}).appendTo(form),$("<br>").appendTo(form),$("<br>").appendTo(form),$("<h2>",{text:"Submit Button Disabled for demo",id:"submitText"}).appendTo(form);var formResp=function(e){var t=!0;e||(t=!1,$("#submitText").html("Submit failed due to a database error, if this problem occurs again please email us at <a href='mailto:UAB.APSA@gmail.com'>UAB.APSA@gmail.com</a>").attr("style","color:red;font-weight:bold;"));for(var i in e)if(e.hasOwnProperty(i))if(e[i]===!1){t=!1,i.match(/Other\-/)&&(i=i.split("-")[1]);var a=$("#"+i).attr("style","color:red;font-weight:bold;");console.log(i),$(a).html($(a).html().replace("! Required Field: ","")),$(a).html("! Required Field: "+$(a).html()),$("#submitText").text("Submit failed, please fill in all necessary feilds.").attr("style","color:red;font-weight:bold;")}else if($("#"+i).text()){var a=$("#"+i).attr("style","color:black;font-weight:normal;");$(a).html($(a).html().replace("! Required Field: ",""))}t&&main.html("<h2>Thank you for submitting, within 30 minutes you will be able to find your project here <a href='http://bit.ly/UABapsa'> UAB APSA</a>. Your personal key for editing this research submission is: "+e.uuid+". This information has been sent to your contact email as well.<br />To complete another submission, please refresh the page.</h2>")};$("input[type=file]").on("change",prepareUpload);